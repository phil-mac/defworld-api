{
  "version": 3,
  "sources": ["../index.ts"],
  "sourcesContent": ["// https://api.elephantsql.com/console/22b867f3-f91d-4cc1-a98f-0ca00c11f316/browser\n\nconst http = require('http');\nconst express = require('express');\nconst cors = require('cors');\nconst sockets = require('socket.io');\n\nconst { ApolloServer } = require('apollo-server-express');\nconst { ApolloServerPluginDrainHttpServer } = require('apollo-server-core');\nconst { WebSocketServer } = require('ws');\nconst { useServer } = require('graphql-ws/lib/use/ws');\n\nconst socketService = require('./services/socketService');\n\nconst { schema, seedDatabase } = require('./schema');\n\n// ---- express ----\nconst app = express();\napp.use(cors());\napp.get('/', async (req: any, res: any) => {\n  res.send('Hello world');\n});\n\n// ---- http ----\nconst httpServer = http.createServer(app);\n\n// ---- sockets ----\nconst io = sockets(httpServer, {\n  cors: {\n    origin: '*',\n    handlePreflightRequest: (req, res) => {\n      res.writeHead(200, {\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Methods': 'GET, POST',\n      });\n      res.end();\n    }\n  }\n});\nsocketService.init(io);\n\n// ---- graphQL ----\nconst wsServer = new WebSocketServer({\n  server: httpServer,\n  path: '/subscriptions',\n});\nconst serverCleanup = useServer({ schema }, wsServer);\nconst server = new ApolloServer({\n  schema,\n  csrfPrevention: true,\n  plugins: [\n    ApolloServerPluginDrainHttpServer({ httpServer }),\n    {\n      async serverWillStart() {\n        return {\n          async drainServer() {\n            await serverCleanup.dispose();\n          }\n        }\n      }\n    }\n  ]\n});\n\n// ---- seed? & listen ----\n(async () => {\n  if (false) await seedDatabase();\n  \n  await server.start();\n  server.applyMiddleware({ app });\n\n  await new Promise(resolve => httpServer.listen({ port: 4000 }, resolve));\n})();"],
  "mappings": "AAEA,MAAM,OAAO,QAAQ;AACrB,MAAM,UAAU,QAAQ;AACxB,MAAM,OAAO,QAAQ;AACrB,MAAM,UAAU,QAAQ;AAExB,MAAM,EAAE,iBAAiB,QAAQ;AACjC,MAAM,EAAE,sCAAsC,QAAQ;AACtD,MAAM,EAAE,oBAAoB,QAAQ;AACpC,MAAM,EAAE,cAAc,QAAQ;AAE9B,MAAM,gBAAgB,QAAQ;AAE9B,MAAM,EAAE,QAAQ,iBAAiB,QAAQ;AAGzC,MAAM,MAAM;AACZ,IAAI,IAAI;AACR,IAAI,IAAI,KAAK,OAAO,KAAU,QAAa;AACzC,MAAI,KAAK;AAAA;AAIX,MAAM,aAAa,KAAK,aAAa;AAGrC,MAAM,KAAK,QAAQ,YAAY;AAAA,EAC7B,MAAM;AAAA,IACJ,QAAQ;AAAA,IACR,wBAAwB,CAAC,KAAK,QAAQ;AACpC,UAAI,UAAU,KAAK;AAAA,QACjB,+BAA+B;AAAA,QAC/B,gCAAgC;AAAA;AAElC,UAAI;AAAA;AAAA;AAAA;AAIV,cAAc,KAAK;AAGnB,MAAM,WAAW,IAAI,gBAAgB;AAAA,EACnC,QAAQ;AAAA,EACR,MAAM;AAAA;AAER,MAAM,gBAAgB,UAAU,EAAE,UAAU;AAC5C,MAAM,SAAS,IAAI,aAAa;AAAA,EAC9B;AAAA,EACA,gBAAgB;AAAA,EAChB,SAAS;AAAA,IACP,kCAAkC,EAAE;AAAA,IACpC;AAAA,YACQ,kBAAkB;AACtB,eAAO;AAAA,gBACC,cAAc;AAClB,kBAAM,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAShC,AAAC,aAAY;AACX,MAAI;AAAO,UAAM;AAEjB,QAAM,OAAO;AACb,SAAO,gBAAgB,EAAE;AAEzB,QAAM,IAAI,QAAQ,aAAW,WAAW,OAAO,EAAE,MAAM,OAAQ;AAAA;",
  "names": []
}
